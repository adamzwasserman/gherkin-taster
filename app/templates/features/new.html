{% extends "base/layout.html" %}

{% block title %}New Requirement - Gherkin Taster{% endblock %}

{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/gherkin/gherkin.min.js"></script>
<style>
    .CodeMirror {
        border: 1px solid #e5e7eb;
        height: auto;
        min-height: 400px;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="px-4 sm:px-0">
    <!-- Header -->
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Write Gherkin Feature</h2>
        <p class="mt-1 text-sm text-gray-600">
            Write your feature specification in Gherkin syntax
        </p>
    </div>

    <!-- Form -->
    <div class="bg-white shadow sm:rounded-lg">
        <form action="/features/create" method="POST" id="gherkin-form" class="px-4 py-5 sm:p-6">
            <!-- Gherkin Editor -->
            <div class="mb-6">
                <label for="gherkin-content" class="block text-sm font-medium text-gray-700 mb-2">
                    Feature Specification <span class="text-red-600">*</span>
                </label>
                <textarea id="gherkin-content" name="content" required style="display:none;">Feature: My New Feature
  As a user
  I want to do something
  So that I can achieve a goal

  Scenario: Example scenario
    Given I am on the home page
    When I click the button
    Then I should see the result</textarea>
                <div id="editor-container"></div>
                <p class="mt-2 text-xs text-gray-500">
                    Write your feature in Gherkin syntax. The feature name will be used as the issue title.
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                <a
                    href="/features"
                    class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                >
                    Cancel
                </a>
                <button
                    type="submit"
                    class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700"
                >
                    Create Feature
                </button>
            </div>
        </form>
    </div>
</div>

{% block scripts %}
<script>
    // Initialize CodeMirror for Gherkin editing
    const textarea = document.getElementById('gherkin-content');
    const editor = CodeMirror(document.getElementById('editor-container'), {
        value: textarea.value,
        mode: 'gherkin',
        lineNumbers: true,
        theme: 'default',
        indentUnit: 2,
        tabSize: 2,
        lineWrapping: true
    });

    // Sync editor content back to textarea on form submit
    document.getElementById('gherkin-form').addEventListener('submit', function() {
        textarea.value = editor.getValue();
    });

    // Auto-focus editor
    editor.focus();
</script>
{% endblock %}
{% endblock %}
